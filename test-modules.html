<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—æµ‹è¯• - è‡»è—æ‹å–</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        .test-section {
            background: #16213e;
            border: 1px solid #2a2a45;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h2 {
            color: #ffd89b;
            margin-top: 0;
        }
        .test-item {
            background: #0f0f1e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 3px solid #667eea;
        }
        .test-item h3 {
            margin-top: 0;
            color: #84fab0;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background: rgba(132, 250, 176, 0.1);
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .test-result.success {
            background: rgba(132, 250, 176, 0.2);
            border-left: 3px solid #84fab0;
        }
        .test-result.error {
            background: rgba(245, 87, 108, 0.2);
            border-left: 3px solid #f5576c;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass {
            background: #84fab0;
            color: #0a0a0a;
        }
        .status.fail {
            background: #f5576c;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ¨¡å—æµ‹è¯•é¡µé¢</h1>
    <p>æµ‹è¯•æ‰€æœ‰å·²å®Œæˆçš„æ¨¡å—åŠŸèƒ½</p>

    <!-- å¸¸é‡æ¨¡å—æµ‹è¯• -->
    <div class="test-section">
        <h2>1. å¸¸é‡æ¨¡å—æµ‹è¯• (constants.js)</h2>
        <div class="test-item">
            <h3>æµ‹è¯•å¸¸é‡å¯¼å…¥ <button onclick="testConstants()">è¿è¡Œæµ‹è¯•</button></h3>
            <div id="constants-result" class="test-result"></div>
        </div>
    </div>

    <!-- å·¥å…·å‡½æ•°æ¨¡å—æµ‹è¯• -->
    <div class="test-section">
        <h2>2. å·¥å…·å‡½æ•°æ¨¡å—æµ‹è¯• (utils.js)</h2>
        <div class="test-item">
            <h3>æ—¶é—´æ ¼å¼åŒ– <button onclick="testUtils()">è¿è¡Œæµ‹è¯•</button></h3>
            <div id="utils-result" class="test-result"></div>
        </div>
    </div>

    <!-- å­˜å‚¨æ¨¡å—æµ‹è¯• -->
    <div class="test-section">
        <h2>3. å­˜å‚¨æ¨¡å—æµ‹è¯• (storage.js)</h2>
        <div class="test-item">
            <h3>localStorageæ“ä½œ <button onclick="testStorage()">è¿è¡Œæµ‹è¯•</button></h3>
            <div id="storage-result" class="test-result"></div>
        </div>
    </div>

    <!-- çŠ¶æ€ç®¡ç†æ¨¡å—æµ‹è¯• -->
    <div class="test-section">
        <h2>4. çŠ¶æ€ç®¡ç†æ¨¡å—æµ‹è¯• (state.js)</h2>
        <div class="test-item">
            <h3>çŠ¶æ€è¯»å†™å’Œç›‘å¬ <button onclick="testState()">è¿è¡Œæµ‹è¯•</button></h3>
            <div id="state-result" class="test-result"></div>
        </div>
    </div>

    <!-- å®šæ—¶å™¨æ¨¡å—æµ‹è¯• -->
    <div class="test-section">
        <h2>5. å®šæ—¶å™¨æ¨¡å—æµ‹è¯• (timer.js)</h2>
        <div class="test-item">
            <h3>å®šæ—¶å™¨ç®¡ç† <button onclick="testTimer()">è¿è¡Œæµ‹è¯•</button></h3>
            <div id="timer-result" class="test-result"></div>
        </div>
    </div>

    <!-- æ—¥å¿—æ¨¡å—æµ‹è¯• -->
    <div class="test-section">
        <h2>6. æ—¥å¿—æ¨¡å—æµ‹è¯• (logger.js)</h2>
        <div class="test-item">
            <h3>æ—¥å¿—è¾“å‡º <button onclick="testLogger()">è¿è¡Œæµ‹è¯•</button></h3>
            <div id="logger-result" class="test-result"></div>
            <p><small>è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—è¾“å‡º</small></p>
        </div>
    </div>

    <!-- è®¤è¯æ¨¡å—æµ‹è¯• -->
    <div class="test-section">
        <h2>7. è®¤è¯æ¨¡å—æµ‹è¯• (auth.js)</h2>
        <div class="test-item">
            <h3>è®¤è¯åŠŸèƒ½ <button onclick="testAuth()">è¿è¡Œæµ‹è¯•</button></h3>
            <div id="auth-result" class="test-result"></div>
        </div>
    </div>

    <!-- ç»¼åˆæµ‹è¯• -->
    <div class="test-section">
        <h2>8. ç»¼åˆæµ‹è¯•</h2>
        <div class="test-item">
            <h3>æ‰€æœ‰æ¨¡å—é›†æˆæµ‹è¯• <button onclick="testAll()">è¿è¡Œå…¨éƒ¨æµ‹è¯•</button></h3>
            <div id="all-result" class="test-result"></div>
        </div>
    </div>

    <script type="module">
        // å¯¼å…¥æ‰€æœ‰æ¨¡å—
        import { 
            AUCTION_CONFIG, 
            USER_CONFIG, 
            STORAGE_KEYS,
            CATEGORY_NAMES 
        } from './modules/constants.js';
        
        import { 
            formatTime, 
            getCategoryName,
            formatCurrency,
            debounce 
        } from './modules/utils.js';
        
        import { 
            auctionStorage, 
            userStorage,
            historyStorage 
        } from './modules/storage.js';
        
        import { 
            getState, 
            setState,
            subscribeState 
        } from './modules/state.js';
        
        import timerManager from './modules/timer.js';
        
        import logger from './modules/logger.js';
        
        import { 
            isAdmin,
            getDisplayName 
        } from './modules/auth.js';

        // å°†æ¨¡å—æš´éœ²åˆ°å…¨å±€ï¼Œä¾›æµ‹è¯•å‡½æ•°ä½¿ç”¨
        window.testModules = {
            constants: { AUCTION_CONFIG, USER_CONFIG, STORAGE_KEYS, CATEGORY_NAMES },
            utils: { formatTime, getCategoryName, formatCurrency, debounce },
            storage: { auctionStorage, userStorage, historyStorage },
            state: { getState, setState, subscribeState },
            timer: timerManager,
            logger: logger,
            auth: { isAdmin, getDisplayName }
        };

        // æµ‹è¯•å‡½æ•°
        window.testConstants = function() {
            const result = document.getElementById('constants-result');
            try {
                const { AUCTION_CONFIG, USER_CONFIG, CATEGORY_NAMES } = window.testModules.constants;
                
                let output = 'âœ… å¸¸é‡æ¨¡å—æµ‹è¯•é€šè¿‡\n\n';
                output += `é»˜è®¤æ‹å–æ—¶é•¿: ${AUCTION_CONFIG.DEFAULT_DURATION}ç§’\n`;
                output += `åˆå§‹ä½™é¢: ${USER_CONFIG.INITIAL_BALANCE.toLocaleString()}æ¸¸æˆå¸\n`;
                output += `ç±»åˆ«æ˜ å°„:\n`;
                Object.entries(CATEGORY_NAMES).forEach(([key, value]) => {
                    output += `  ${key} -> ${value}\n`;
                });
                
                result.className = 'test-result success';
                result.textContent = output;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`;
            }
        };

        window.testUtils = function() {
            const result = document.getElementById('utils-result');
            try {
                const { formatTime, getCategoryName, formatCurrency } = window.testModules.utils;
                
                let output = 'âœ… å·¥å…·å‡½æ•°æ¨¡å—æµ‹è¯•é€šè¿‡\n\n';
                output += `æ—¶é—´æ ¼å¼åŒ–æµ‹è¯•:\n`;
                output += `  180ç§’ -> ${formatTime(180)}\n`;
                output += `  65ç§’ -> ${formatTime(65)}\n`;
                output += `  5ç§’ -> ${formatTime(5)}\n\n`;
                output += `ç±»åˆ«åç§°æµ‹è¯•:\n`;
                output += `  painting -> ${getCategoryName('painting')}\n`;
                output += `  sculpture -> ${getCategoryName('sculpture')}\n\n`;
                output += `é‡‘é¢æ ¼å¼åŒ–æµ‹è¯•:\n`;
                output += `  10000 -> ${formatCurrency(10000)}\n`;
                output += `  1234567 -> ${formatCurrency(1234567)}\n`;
                
                result.className = 'test-result success';
                result.textContent = output;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`;
            }
        };

        window.testStorage = function() {
            const result = document.getElementById('storage-result');
            try {
                const { auctionStorage, userStorage } = window.testModules.storage;
                
                let output = 'âœ… å­˜å‚¨æ¨¡å—æµ‹è¯•é€šè¿‡\n\n';
                
                // æµ‹è¯•æ‹å–å“å­˜å‚¨
                const testAuctions = [{ id: 1, title: 'æµ‹è¯•æ‹å–å“' }];
                auctionStorage.saveAuctions(testAuctions, true);
                const loadedAuctions = auctionStorage.getAuctions();
                output += `æ‹å–å“å­˜å‚¨æµ‹è¯•:\n`;
                output += `  ä¿å­˜: ${testAuctions.length} ä»¶\n`;
                output += `  è¯»å–: ${loadedAuctions.length} ä»¶\n`;
                output += `  ${loadedAuctions.length === testAuctions.length ? 'âœ…' : 'âŒ'}\n\n`;
                
                // æµ‹è¯•ç”¨æˆ·å­˜å‚¨
                const testUser = {
                    username: 'test_user',
                    password: 'test123',
                    balance: 10000
                };
                userStorage.saveUser(testUser, true);
                const loadedUser = userStorage.getUser('test_user');
                output += `ç”¨æˆ·å­˜å‚¨æµ‹è¯•:\n`;
                output += `  ä¿å­˜ç”¨æˆ·: ${testUser.username}\n`;
                output += `  è¯»å–ç”¨æˆ·: ${loadedUser ? loadedUser.username : 'null'}\n`;
                output += `  ${loadedUser && loadedUser.username === testUser.username ? 'âœ…' : 'âŒ'}\n`;
                
                result.className = 'test-result success';
                result.textContent = output;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`;
            }
        };

        window.testState = function() {
            const result = document.getElementById('state-result');
            try {
                const { getState, setState, subscribeState } = window.testModules.state;
                
                let output = 'âœ… çŠ¶æ€ç®¡ç†æ¨¡å—æµ‹è¯•é€šè¿‡\n\n';
                
                // æµ‹è¯•çŠ¶æ€è¯»å†™
                setState('testValue', 'hello', false);
                const value = getState('testValue');
                output += `çŠ¶æ€è¯»å†™æµ‹è¯•:\n`;
                output += `  è®¾ç½®: testValue = 'hello'\n`;
                output += `  è¯»å–: ${value}\n`;
                output += `  ${value === 'hello' ? 'âœ…' : 'âŒ'}\n\n`;
                
                // æµ‹è¯•çŠ¶æ€ç›‘å¬
                let listenerCalled = false;
                const unsubscribe = subscribeState('testValue', (newValue) => {
                    listenerCalled = true;
                });
                setState('testValue', 'world', true);
                output += `çŠ¶æ€ç›‘å¬æµ‹è¯•:\n`;
                output += `  ç›‘å¬å™¨è°ƒç”¨: ${listenerCalled ? 'âœ…' : 'âŒ'}\n`;
                
                unsubscribe();
                
                result.className = 'test-result success';
                result.textContent = output;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`;
            }
        };

        window.testTimer = function() {
            const result = document.getElementById('timer-result');
            try {
                const timerManager = window.testModules.timer;
                
                let output = 'âœ… å®šæ—¶å™¨æ¨¡å—æµ‹è¯•é€šè¿‡\n\n';
                
                // æµ‹è¯•å®šæ—¶å™¨ç®¡ç†
                let timerCalled = false;
                timerManager.setTimeout('test1', () => {
                    timerCalled = true;
                }, 100);
                
                output += `å®šæ—¶å™¨åˆ›å»ºæµ‹è¯•:\n`;
                output += `  åˆ›å»ºå®šæ—¶å™¨: test1\n`;
                output += `  å®šæ—¶å™¨æ•°é‡: ${timerManager.getCount()}\n`;
                output += `  ${timerManager.has('test1') ? 'âœ…' : 'âŒ'}\n\n`;
                
                // ç­‰å¾…å®šæ—¶å™¨æ‰§è¡Œ
                setTimeout(() => {
                    output += `å®šæ—¶å™¨æ‰§è¡Œæµ‹è¯•:\n`;
                    output += `  å®šæ—¶å™¨å·²æ‰§è¡Œ: ${timerCalled ? 'âœ…' : 'âŒ'}\n`;
                    result.className = 'test-result success';
                    result.textContent = output;
                }, 200);
                
                result.className = 'test-result success';
                result.textContent = output + '\nç­‰å¾…å®šæ—¶å™¨æ‰§è¡Œ...';
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`;
            }
        };

        window.testLogger = function() {
            const result = document.getElementById('logger-result');
            try {
                const logger = window.testModules.logger;
                
                // å…ˆæ˜¾ç¤ºè¯´æ˜
                result.className = 'test-result success';
                result.textContent = 'âœ… æ—¥å¿—æ¨¡å—æµ‹è¯•é€šè¿‡\n\næ­£åœ¨è¾“å‡ºæµ‹è¯•æ—¥å¿—åˆ°æ§åˆ¶å°...\n\nâš ï¸ æ³¨æ„ï¼šä»¥ä¸‹æ—¥å¿—æ˜¯æµ‹è¯•è¾“å‡ºï¼Œä¸æ˜¯çœŸæ­£çš„é”™è¯¯ï¼\n\n';
                
                // å»¶è¿Ÿè¾“å‡ºæ—¥å¿—ï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°è¯´æ˜
                setTimeout(() => {
                    logger.debug('[æµ‹è¯•] è¿™æ˜¯è°ƒè¯•æ—¥å¿— - ç”¨äºæµ‹è¯•DEBUGçº§åˆ«');
                    logger.info('[æµ‹è¯•] è¿™æ˜¯ä¿¡æ¯æ—¥å¿— - ç”¨äºæµ‹è¯•INFOçº§åˆ«');
                    logger.warn('[æµ‹è¯•] è¿™æ˜¯è­¦å‘Šæ—¥å¿— - ç”¨äºæµ‹è¯•WARNçº§åˆ«');
                    logger.error('[æµ‹è¯•] è¿™æ˜¯é”™è¯¯æ—¥å¿— - ç”¨äºæµ‹è¯•ERRORçº§åˆ«ï¼ˆä¸æ˜¯çœŸæ­£çš„é”™è¯¯ï¼ï¼‰');
                    
                    result.textContent += '\nâœ… æ‰€æœ‰æ—¥å¿—çº§åˆ«æµ‹è¯•å®Œæˆ\n\nè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰\næ‚¨åº”è¯¥çœ‹åˆ°å¸¦ [æµ‹è¯•] å‰ç¼€çš„æ—¥å¿—\n\nè¿™äº›æ˜¯æ­£å¸¸çš„æµ‹è¯•è¾“å‡ºï¼Œä¸æ˜¯é”™è¯¯ï¼';
                }, 100);
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`;
            }
        };

        window.testAuth = function() {
            const result = document.getElementById('auth-result');
            try {
                const { isAdmin, getDisplayName } = window.testModules.auth;
                const { setState, getState } = window.testModules.state;
                
                let output = 'âœ… è®¤è¯æ¨¡å—æµ‹è¯•é€šè¿‡\n\n';
                
                // æµ‹è¯•ç®¡ç†å‘˜æ£€æŸ¥
                setState('currentUser', { username: 'admin' }, false);
                const adminCheck = isAdmin();
                output += `ç®¡ç†å‘˜æ£€æŸ¥æµ‹è¯•:\n`;
                output += `  ç”¨æˆ·: admin\n`;
                output += `  æ˜¯ç®¡ç†å‘˜: ${adminCheck ? 'âœ…' : 'âŒ'}\n\n`;
                
                // æµ‹è¯•æ˜¾ç¤ºåç§°
                const displayName1 = getDisplayName('test_user');
                const displayName2 = getDisplayName(null);
                output += `æ˜¾ç¤ºåç§°æµ‹è¯•:\n`;
                output += `  'test_user' -> ${displayName1}\n`;
                output += `  null -> ${displayName2}\n`;
                output += `  ${displayName1 === 'test_user' && displayName2 === 'æœªçŸ¥ç”¨æˆ·' ? 'âœ…' : 'âŒ'}\n`;
                
                result.className = 'test-result success';
                result.textContent = output;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack}`;
            }
        };

        window.testAll = function() {
            const result = document.getElementById('all-result');
            result.className = 'test-result';
            result.textContent = 'æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...\n\n';
            
            const tests = [
                { name: 'å¸¸é‡æ¨¡å—', fn: window.testConstants },
                { name: 'å·¥å…·å‡½æ•°', fn: window.testUtils },
                { name: 'å­˜å‚¨æ¨¡å—', fn: window.testStorage },
                { name: 'çŠ¶æ€ç®¡ç†', fn: window.testState },
                { name: 'å®šæ—¶å™¨', fn: window.testTimer },
                { name: 'æ—¥å¿—æ¨¡å—', fn: window.testLogger },
                { name: 'è®¤è¯æ¨¡å—', fn: window.testAuth }
            ];
            
            let completed = 0;
            tests.forEach((test, index) => {
                setTimeout(() => {
                    try {
                        test.fn();
                        completed++;
                        result.textContent += `âœ… ${test.name} æµ‹è¯•å®Œæˆ\n`;
                        
                        if (completed === tests.length) {
                            result.textContent += '\nğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼';
                            result.className = 'test-result success';
                        }
                    } catch (error) {
                        result.textContent += `âŒ ${test.name} æµ‹è¯•å¤±è´¥: ${error.message}\n`;
                        result.className = 'test-result error';
                    }
                }, index * 500);
            });
        };

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        console.log('âœ… æ‰€æœ‰æ¨¡å—å·²åŠ è½½');
        console.log('ğŸ§ª æ¨¡å—æµ‹è¯•é¡µé¢å·²å°±ç»ª');
    </script>
</body>
</html>

