# ⚡ 一键部署指南（Firebase Hosting + GitHub Actions 自动部署）

本项目已升级为 **Vite + Firebase Hosting**，并支持 **Realtime Database 云同步（默认开启）**。

---

## ✅ 你将得到什么

- **推送代码即自动上线**（GitHub Actions）
- **只部署 Hosting**（`firebase deploy --only hosting`）
- **云同步默认开启**：Realtime Database + Anonymous Auth（未配置 env 会自动回退本地存储）

---

## 0）准备：新建 Firebase 项目（一次性）

在 Firebase Console 新建项目并完成以下开关：

- **Hosting**：Get started
- **Realtime Database**：Create database
- **Authentication**：启用 **Anonymous**

Realtime Database Rules（建议）设置为：

```json
{
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null"
  }
}
```

仓库里已提供同内容文件：`database.rules.json`。

---

## 1）创建 Web App 并拿到配置（一次性）

Firebase Console → 项目设置 → Your apps → Web App → 复制配置并准备填入下面的环境变量：

- `VITE_FIREBASE_API_KEY`
- `VITE_FIREBASE_AUTH_DOMAIN`
- `VITE_FIREBASE_DATABASE_URL`
- `VITE_FIREBASE_PROJECT_ID`
- `VITE_FIREBASE_APP_ID`

本地开发：将 `env.example` 复制为 `.env.local`，填入以上值。

---

## 2）配置 GitHub Actions 自动部署（一次性）

### 2.1 创建 Service Account（推荐）

Google Cloud Console（对应你的 Firebase 项目）→ IAM & Admin → Service Accounts：

- 创建一个 Service Account
- 授予最小权限：建议先用 **Firebase Hosting Admin**（或更高权限用于快速打通）
- 生成 **JSON key**

### 2.2 在 GitHub 仓库添加 Secrets

GitHub → Settings → Secrets and variables → Actions → New repository secret：

- `FIREBASE_SERVICE_ACCOUNT_JSON`：粘贴整个 JSON 内容（不要 base64）
- `VITE_FIREBASE_API_KEY`
- `VITE_FIREBASE_AUTH_DOMAIN`
- `VITE_FIREBASE_DATABASE_URL`
- `VITE_FIREBASE_PROJECT_ID`
- `VITE_FIREBASE_APP_ID`

> 说明：workflow 文件为 `.github/workflows/firebase-hosting-deploy.yml`，会在 push main 时自动 build 并 deploy。

---

## 3）首次本地部署（可选）

如果你希望本地一键部署（不依赖 CI）：

```bash
npm install
# 复制 env.example -> .env.local 并填好 Firebase 配置
npx firebase-tools login
npx firebase-tools use --add   # 选择你新建的 Firebase 项目
npm run deploy
```

---

## ✅ 日常发布（最简单）

以后发布只要：

```bash
git add .
git commit -m "update"
git push
```

GitHub Actions 会自动部署到 Firebase Hosting（生产环境）。

